---
title: "JVM ã‚’èª­ã‚€ | JVM ã®æ§‹é€ ãã®ï¼’ - ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã«ã¤ã„ã¦"
emoji: "ğŸ–¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["java", "jvm", "jal"]
published: true
---

å‰å›ã®ç¶šãã§ã™ã€‚å‰å›ã¯ã“ã¡ã‚‰ã‹ã‚‰ã€‚

https://zenn.dev/peyang/articles/reading-jvm-chapter-02-1-4 

ã“ã®ã‚·ãƒªãƒ¼ã‚ºã¯ï¼ŒJVM ã®ä»•æ§˜æ›¸ã‚’èª­ã¿è§£ããŸã‚ã®ã‚¬ã‚¤ãƒ‰ã¨ã—ã¦æ§‹æˆã—ã¦ã„ã¾ã™ã€‚
JVM ã®ä»•æ§˜æ›¸ã¯éå¸¸ã«é•·å¤§ã§é›£è§£ãªå†…å®¹ãŒå¤šã„ãŸã‚ï¼Œå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«è¦ç‚¹ã‚’ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚
ã¾ãŸï¼ŒJVM ã®å†…éƒ¨æ§‹é€ ã‚„å‹•ä½œåŸç†ã‚’çŸ¥ã‚‹ã“ã¨ã§ï¼ŒJava ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼Œãƒ¡ãƒ¢ãƒªç®¡ç†ã®ä»•çµ„ã¿ã‚’æ·±ãç†è§£ã™ã‚‹è©¦ã¿ã§ã™ã€‚

ã‚·ãƒªãƒ¼ã‚ºã¯ã“ã¡ã‚‰ã‹ã‚‰ã€‚

https://zenn.dev/peyang/articles/reading-jvm-chapter-00

## ç¬¬äºŒç«  The Structure of the Java Virtual Machine

JVM ã®ä»•æ§˜æ›¸ã®ç¬¬ï¼’ç« ã¯ã€ŒJava Virtual Machine ã®æ§‹é€ ã€ã§ã™ã€‚
ã¨ã„ã„ã¾ã—ã¦ã‚‚ã“ã®ç« ã¯å…¨ï¼—ç« ã‚ã‚‹ JVM ã®ä»•æ§˜æ›¸ã®ä¸­ã§ã‚‚ç‰¹ã«é•·ãï¼Œã¾ãŸç‰¹ã«è¤‡é›‘ãªå†…å®¹ã§ã™ã®ã§ï¼Œã“ã®è¨˜äº‹ã§ã¯è¤‡æ•°ã«åˆ†ã‘ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

ã“ã“ã§ã¯ Chapter 2.5 ã®å†…å®¹ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ™‚ã®ãƒ‡ãƒ¼ã‚¿é ˜åŸŸï¼‰ã‚’æ‰±ã„ã¾ã™ã€‚

## 2.5 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ™‚ã®ãƒ‡ãƒ¼ã‚¿é ˜åŸŸï¼ˆ[â€º 2.5 Runtime Data Areas](https://docs.oracle.com/javase/specs/jvms/se24/html/jvms-2.html#jvms-2.5)ï¼‰

JVM ã¯å®Ÿè¡Œæ™‚ã«ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿é ˜åŸŸã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã¯ãã®æ€§è³ªã«ã‚ˆã£ã¦æ¬¡ã®ã‚ˆã†ã«åˆ†é¡ã•ã‚Œã¾ã™ï¼š

+ **JVM å…¨ä½“**ã«å­˜åœ¨ã™ã‚‹ã‚‚ã®ï¼šJVM ã®èµ·å‹•æ™‚ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œä¸­ã«å…±æœ‰ã•ã‚Œã¾ã™ã€‚
  - ãƒ’ãƒ¼ãƒ—
  - ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ
  - ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«
+ **ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨**ã«å­˜åœ¨ã™ã‚‹ã‚‚ã®ï¼šã‚¹ãƒ¬ãƒƒãƒ‰ã®ä½œæˆæ™‚ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œï¼Œã‚¹ãƒ¬ãƒƒãƒ‰ã®çµ‚äº†æ™‚ã«è§£æ”¾ã•ã‚Œã¾ã™ã€‚
  - `pc` ãƒ¬ã‚¸ã‚¹ã‚¿
  - JVM ã‚¹ã‚¿ãƒƒã‚¯
  - ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¹ã‚¿ãƒƒã‚¯
+ **ã‚¯ãƒ©ã‚¹ã”ã¨**ã«å­˜åœ¨ã™ã‚‹ã‚‚ã®ï¼šã‚¯ãƒ©ã‚¹ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨ãã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œï¼Œã‚¯ãƒ©ã‚¹ã®ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã«è§£æ”¾ã•ã‚Œã¾ã™ã€‚
  - ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«
  - ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  - ã‚¯ãƒ©ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã®æƒ…å ±
  - é™çš„å¤‰æ•°ãªã©

ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã¯ã€JVM ã®å®Ÿè¡Œæ™‚ã«å¿…è¦ãªæƒ…å ±ã‚’æ ¼ç´ã—ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

### `pc` ãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ï¼‰

JVM ã¯ï¼Œç¾åœ¨å®Ÿè¡Œä¸­ã®å‘½ä»¤ã®ä½ç½®ã‚’ç¤ºã™ `pc`ï¼ˆProgram Counterï¼‰ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’æŒã¡ã¾ã™ã€‚
`pc` ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ç¾åœ¨å®Ÿè¡Œä¸­ã®å‘½ä»¤ã®ä½ç½®ã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚Šï¼Œå„ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã«ï¼‘ã¤å­˜åœ¨ã—ã¾ã™ã€‚

å„ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ï¼Œã©ã®ç¬é–“ã«ãŠã„ã¦ã‚‚ï¼ˆæˆ–ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®ï¼‰ï¼‘ã¤ã®å‘½ä»¤ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚
ãã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `native` ãƒ¡ã‚½ãƒƒãƒ‰ã§ãªã„é™ã‚Šã¯ï¼Œãã®å‘½ä»¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ `pc` ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã‚ˆã£ã¦æŒ‡ã—ç¤ºã•ã‚Œã¾ã™ã€‚
ï¼ˆ`native` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ JVM ã®å¤–éƒ¨ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€`pc` ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ã€‚ãã®å ´åˆã¯ `undefined` ã§ã™ã€‚ï¼‰

### JVM ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ï¼‰

JVM ã¯ï¼ŒJVM ã‚¹ã‚¿ãƒƒã‚¯ã‚’å„ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã«ï¼‘ã¤æŒã¡ã¾ã™ã€‚

ã“ã‚Œã¯[ãƒ•ãƒ¬ãƒ¼ãƒ ](reading-jvm-chapter-02-6.md)ã¨å‘¼ã°ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ ¼ç´ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã§ã™ã€‚
ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã¯ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã‚ã‚Šï¼Œ ä¾‹ãˆã°ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ï¼Œã‚ªãƒšãƒ©ãƒ³ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ï¼Œå‹•çš„ãƒªãƒ³ã‚¯ï¼ŒãŠã‚ˆã³ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚

ãƒ•ãƒ¬ãƒ¼ãƒ ã¯ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã³ã«ã‚¹ã‚¿ãƒƒã‚¯ã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè¡ŒãŒçµ‚äº†ã™ã‚‹ã¨ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰ãƒãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚

:::message
JVM ä»•æ§˜ã§ã¯ï¼Œã‚¹ã‚¿ãƒƒã‚¯ã®ã‚µã‚¤ã‚ºã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã„ã¾ã›ã‚“ã€‚
ã™ãªã‚ã¡ï¼Œå›ºå®šã‚µã‚¤ã‚ºã«ã™ã‚‹ã“ã¨ã‚‚ï¼Œå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ã®ã‚µã‚¤ã‚ºã¯ JVM ã®å®Ÿè£…ã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ã€ã‚¹ã‚¿ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰
:::

### ãƒ’ãƒ¼ãƒ—ï¼ˆJVM å…¨ä½“ï¼‰

JVM ã¯ï¼Œã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§å…±æœ‰ã•ã‚Œã‚‹ãƒ’ãƒ¼ãƒ—é ˜åŸŸã‚’æŒã¡ã¾ã™ã€‚
ãƒ’ãƒ¼ãƒ—é ˜åŸŸã¨ã¯ï¼Œç·ã¦ã®ã‚¯ãƒ©ã‚¹ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨é…åˆ—ã®å®Ÿä½“ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹é ˜åŸŸã§ã™ã€‚

ãƒ’ãƒ¼ãƒ—ã¯ JVM ã®èµ·å‹•æ™‚ã«ä½œæˆã•ã‚Œã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œä¸­ã«å‹•çš„ã«æ‹¡å¼µã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®ãƒ’ãƒ¼ãƒ—ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯è‡ªå‹•çš„ã«ç®¡ç†ã•ã‚Œï¼Œè¦ç´ ã®å‰²ã‚Šå½“ã¦ã¨è§£æ”¾ã¯**ã‚¬ãƒ¼ãƒ™ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ã‚·ã‚¹ãƒ†ãƒ **ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚
ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆGCï¼‰ã¨ã¯ï¼Œä¸è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã—ï¼Œè§£æ”¾ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚
ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚¿ã¨ã„ã†ç‰¹åˆ¥ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã“ã®å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚

:::message
JVM ä»•æ§˜ã§ã¯ï¼Œã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚¿ã®å…·ä½“çš„ãªå®Ÿè£…ã‚„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®šç¾©ã¯è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
ã¾ãŸï¼Œãƒ’ãƒ¼ãƒ—ã®ã‚µã‚¤ã‚ºã®åˆ¶é™ã‚‚ã‚ã‚Šã¾ã›ã‚“ã—ï¼Œãƒ’ãƒ¼ãƒ—ç”¨ã®ãƒ¡ãƒ¢ãƒªãŒé€£ç¶šã—ã¦ã„ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã›ã‚“ï¼ˆãƒ¡ãƒ¢ãƒªé…ç½®ãŒé›¢æ•£çš„ã§ã‚ã£ã¦ã‚‚ã‚ˆã„ï¼‰ã€‚

ãŸã ã—ï¼Œä½¿ç”¨ã§ãã‚‹ãƒ’ãƒ¼ãƒ—ã‚µã‚¤ã‚ºä»¥ä¸Šã®ãƒ’ãƒ¼ãƒ—ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆï¼Œ JVM ã¯ `OutOfMemoryError` ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
:::

#### ãºã‚„ã‚“ãæ³¨

ãƒ’ãƒ¼ãƒ—ã«ã¤ã„ã¦ï¼ŒEden é ˜åŸŸã‚„ Survivor é ˜åŸŸï¼ŒOld é ˜åŸŸãªã©ã®è©³ç´°ãªèª¬æ˜ã‚’ã‚ˆãã¿ã¾ã™ã€‚
ã‚ã‚Œã¯ JVM ã®å®Ÿè£…ã«ä¾å­˜ã™ã‚‹éƒ¨åˆ†ã§ã‚ã‚Šï¼Œå®Ÿã¯ JVM ä»•æ§˜æ›¸ã§ã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
ãƒ’ãƒ¼ãƒ—ã¯å˜ã«ã€Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿä½“ãŒæ ¼ç´ã•ã‚Œã‚‹é ˜åŸŸã€ã§ã‚ã‚Šï¼Œãã®å®Ÿè£…ã¯ JVM ã®å®Ÿè£…è€…ã«ä»»ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã§ã™ã‹ã‚‰ï¼Œãƒ’ãƒ¼ãƒ—ã®å®Ÿè£…ã¯ JVM ã®å®Ÿè£…ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ç‰¹ã« Eden é ˜åŸŸã‚„ Survivor é ˜åŸŸï¼Œæˆ–ã„ã¯ Old é ˜åŸŸãªã©ã¯ HotSpot JVM ã®å®Ÿè£…ã«ç‰¹æœ‰ã®æ¦‚å¿µã§ã‚ã‚Šï¼Œä»–ã® VM å®Ÿè£…ã§ã¯ç•°ãªã‚‹å®Ÿè£…ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã° G1GCï¼ˆGarbage-First Garbage Collectorï¼‰ã§ã¯ï¼Œãƒ’ãƒ¼ãƒ—ã¯è¤‡æ•°ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆ†å‰²ã•ã‚Œã¦ãŠã‚Šï¼Œå„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹å½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
Eden é ˜åŸŸç­‰ã®æ¦‚å¿µã¯ã‚ã‚Šã¾ã™ãŒï¼ŒHotSpot JVM ã®ã‚ˆã†ã«æ˜ç¢ºã«åŒºåˆ†ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã•ã‚‰ã« [ZGCï¼ˆThe Z Garbage Collectorï¼‰](https://wiki.openjdk.org/display/zgc/Main) ã‚„ [Shenandoah GC](https://wiki.openjdk.org/display/shenandoah/Main) ãªã©ã®æ–°ã—ã„ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚¿ã§ã¯ï¼Œãƒ’ãƒ¼ãƒ—ã®ç®¡ç†æ–¹æ³•ãŒã•ã‚‰ã«ç•°ãªã‚Šï¼Œ
ã“ã‚Œã‚‰ã®ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚¿å®Ÿè£…ã§ã¯ Eden é ˜åŸŸã‚„ Survivor é ˜åŸŸã®æ¦‚å¿µã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚

ï¼ˆè„šæ³¨ãŠã‚ã‚Šã€‚ï¼‰

### ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸï¼ˆJVM å…¨ä½“ï¼‰

JVM ã¯ï¼Œã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§å…±æœ‰ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸã‚’æŒã¡ã¾ã™ã€‚
ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸã¯ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŠã‚ˆã³ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ï¼ŒãŠã‚ˆã³ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿åŠã³æ§‹é€ ãƒ‡ãƒ¼ã‚¿ãªã©ã®æƒ…å ±ã‚’æ ¼ç´ã—ã¾ã™ã€‚

ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸã¯ JVM ã®èµ·å‹•æ™‚ã«ä½œæˆã•ã‚Œã¾ã™ã€‚
ã•ã‚‰ã«ã“ã‚Œã¯ï¼ˆç†è«–çš„ã«ã¯ï¼‰ãƒ’ãƒ¼ãƒ—é ˜åŸŸã®ä¸€éƒ¨ã§ï¼Œæˆ–ã‚‹å˜ç´”ãªå®Ÿè£…ã§ã¯ã‚¬ãƒ™ãƒ¼ã‚¸ãƒ»ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚‚è¡Œã‚ãªãã¦ã‚‚ã‚ˆã„ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
ï¼ˆãªãœãªã‚‰ï¼Œã‚¯ãƒ©ã‚¹ã®æ§‹é€ ã‚„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©ã¯é€šå¸¸ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œä¸­ã«å¤‰æ›´ã•ã‚Œãªã„ä¸Šã«ï¼Œæ˜ç¤ºçš„ã«ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ã‚‚ãªã„ã‹ã‚‰ã§ã™ã€‚ï¼‰

:::message
JVM ä»•æ§˜ã§ã¯ï¼Œãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸã®ã‚µã‚¤ã‚ºã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã„ã¾ã›ã‚“ã€‚
ã¾ãŸï¼Œä½¿ç”¨ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸã‚µã‚¤ã‚ºä»¥ä¸Šã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€JVM ã¯ `OutOfMemoryError` ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
:::

### ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ï¼ˆã‚¯ãƒ©ã‚¹ã”ã¨ï¼‰

å„ã‚¯ãƒ©ã‚¹ã¯ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ã¨å‘¼ã°ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æŒã¡ã¾ã™ã€‚
ã“ã‚Œã¯ã‚¯ãƒ©ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã® `constant_pool` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¾Œè¿°ï¼‰ã®å€¤ã‚’ã‚¯ãƒ©ã‚¹ã”ã¨ï¼Œã¾ãŸã¯ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã”ã¨ã«æ ¼ç´ã™ã‚‹ãŸã‚ã®é ˜åŸŸã§ã™ã€‚
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å®šç¾©ã•ã‚ŒãŸãƒªãƒ†ãƒ©ãƒ«ã‚„ï¼Œå®Ÿè¡Œæ™‚ã«è§£æ±ºã™ã‚‹å¿…è¦ã®ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‚ç…§ã¾ã§ï¼Œã„ã‚ã„ã‚ãªå®šæ•°ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚

ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ã«ã¯ï¼Œä»–ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ã‚·ãƒ³ãƒœãƒ«ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ä¼¼ãŸã‚ˆã†ãªå½¹å‰²ãŒã‚ã‚Šã¾ã™ãŒï¼Œ
JVM ã§ã¯ãã‚Œã‚ˆã‚Šã‚‚ã¯ã‚‹ã‹ã«å¤šãã®æƒ…å ±ã‚’æ ¼ç´ã—ã¾ã™ã€‚

å„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ã¯ï¼ŒJVM ã®[ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ](#ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸjvm-å…¨ä½“)å†…ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚
ã•ã‚‰ã«ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ã¯ï¼ŒJVM ã«ã‚ˆã£ã¦ã‚¯ãƒ©ã‚¹ã¾ãŸã¯ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨ãã«æ§‹ç¯‰ã•ã‚Œã¾ã™ã€‚

ãªãŠï¼Œã“ã‚Œã‚‚åŒæ§˜ã«ä½¿ç”¨ã§ãã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«ã®ã‚µã‚¤ã‚ºä»¥ä¸Šã®å®šæ•°ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€JVM ã¯ `OutOfMemoryError` ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚

### ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ï¼‰

JVM ã¯ï¼Œãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ã‚’æŒã¡ã¾ã™ã€‚

ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ã€Java è¨€èªä»¥å¤–ã®è¨€èªï¼ˆC ã‚„ C++ ãªã©ï¼‰ã§å®Ÿè£…ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã®ã“ã¨ã§ã™ã€‚
JVM ã¯ã“ã‚Œã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ï¼Œå¾“æ¥ã® C è¨€èªã®ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

æˆ–ã‚‹ JVM ã®å®Ÿè£…ã§ï¼Œãã‚ŒãŒãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼ˆãã‚‚ãã‚‚å‘¼ã³å‡ºã›ãªã„ï¼Œã¾ãŸã¯è‡ªåˆ†è‡ªèº«ãŒå¾“æ¥ã®ã‚¹ã‚¿ãƒƒã‚¯ã«ä¾å­˜ã—ãªã„å ´åˆï¼‰ã«ã¯ã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãªãŠï¼Œè¨±å®¹ã§ãã‚‹ã‚ˆã‚Šã‚‚ã‚ˆã‚Šå¤šãã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã¯ï¼Œ`StackOverflowError` ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
ã¾ãŸã“ã®æ‹¡å¼µã‚’è©¦ã¿ã¦ï¼Œãã‚Œã«ã‚‚å¤±æ•—ã—ãŸå ´åˆã¯ï¼Œ`OutOfMemoryError` ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚

### å›³ã«ã™ã‚‹ã¨â€¦

```mermaid
classDiagram
    class JVM
    JVM : ãƒ»ãƒ’ãƒ¼ãƒ—
    JVM : ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ
    JVM : ãƒ»ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§

    class ãƒ’ãƒ¼ãƒ—
    ãƒ’ãƒ¼ãƒ— : ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿä½“

    class ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ
    ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ : ãƒ»ã‚¯ãƒ©ã‚¹å®šç¾©æƒ…å ±
    ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ : ãƒ»é™çš„å¤‰æ•°
    ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ : ãƒ»ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«

    class ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ«
    ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ« : ãƒ»ã‚¯ãƒ©ã‚¹ã”ã¨ã«å­˜åœ¨
    ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ« : ãƒ»ãƒªãƒ†ãƒ©ãƒ«ã‚„ã‚·ãƒ³ãƒœãƒ«ï¼Œå‚ç…§

    class ã‚¹ãƒ¬ãƒƒãƒ‰
    ã‚¹ãƒ¬ãƒƒãƒ‰ : ãƒ»PCãƒ¬ã‚¸ã‚¹ã‚¿ï¼ˆç¾åœ¨å®Ÿè¡Œä¸­ã®å‘½ä»¤ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
    ã‚¹ãƒ¬ãƒƒãƒ‰ : ãƒ»Javaä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã”ã¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰
    ã‚¹ãƒ¬ãƒƒãƒ‰ : ãƒ»ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¡ã‚½ãƒƒãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–å‘¼ã³å‡ºã—ç”¨ï¼‰

    class PCãƒ¬ã‚¸ã‚¹ã‚¿
    PCãƒ¬ã‚¸ã‚¹ã‚¿ : ãƒ»ç¾åœ¨ã®å‘½ä»¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
    class Javaä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚¿ãƒƒã‚¯
    Javaä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ : ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ 
    Javaä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ : ãƒ»å„ãƒ•ãƒ¬ãƒ¼ãƒ 

    class ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¡ã‚½ãƒƒãƒ‰ã‚¹ã‚¿ãƒƒã‚¯

    JVM "1" --> "1..*" ã‚¹ãƒ¬ãƒƒãƒ‰ : ç®¡ç†
    JVM "1" --> "1" ãƒ’ãƒ¼ãƒ— : å…±æœ‰é ˜åŸŸ
    JVM "1" --> "1" ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ : å…±æœ‰é ˜åŸŸ
    ãƒ¡ã‚½ãƒƒãƒ‰é ˜åŸŸ "1" --> "*" ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å®šæ•°ãƒ—ãƒ¼ãƒ« : ã‚¯ãƒ©ã‚¹ã”ã¨ã«
    ã‚¹ãƒ¬ãƒƒãƒ‰ "1" --> "1" PCãƒ¬ã‚¸ã‚¹ã‚¿ : ä¿æŒ
    ã‚¹ãƒ¬ãƒƒãƒ‰ "1" --> "1" Javaä»®æƒ³ãƒã‚·ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ : ä¿æŒ
    ã‚¹ãƒ¬ãƒƒãƒ‰ "1" --> "1" ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¡ã‚½ãƒƒãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ : ä¿æŒ
```

## ã¾ã¨ã‚

ã„ã‹ãŒã§ã—ãŸã‹ï¼Ÿ
JVM ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ™‚ã®ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã¯ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®é‡è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚
ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã¯ã€JVM ã®å‹•ä½œã‚’ç†è§£ã™ã‚‹ä¸Šã§éå¸¸ã«é‡è¦ã§ã™ã€‚
æ¬¡å›ã¯ Chapter 2.6 ã®å†…å®¹ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰ã‚’æ‰±ã„ã¾ã™ã€‚

ã§ã¯ï¼Œã‚ˆã„ãƒã‚¤ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ•ã‚’ï¼

#### æ¬¡å›ãƒªãƒ³ã‚¯

https://zenn.dev/peyang/articles/reading-jvm-chapter-02-6

#### å‚è€ƒæ–‡çŒ®ï¼†ãƒªãƒ³ã‚¯é›†

+ Lindholm, T., Yellin, F., Bracha, G., & Smith, W. M. D. (2025). [*The JavaÂ® Virtual Machine Specification: Java SE 24 Edition*](https://docs.oracle.com/javase/specs/jvms/se24/html/).
+ Lindholm, T., & Yellin, F. (1999). *The Javaâ„¢ Virtual Machine Specification* (2nd ed.). Addison-Wesley. ISBN 978-0-201-43294-7
+ Otavio, S. (2024). *Mastering the Java Virtual Machine*.  Packet Publishing. ISBN 978-1-835-46796-1
